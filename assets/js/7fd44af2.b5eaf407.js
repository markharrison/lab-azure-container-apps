"use strict";(self.webpackChunklab_container_apps=self.webpackChunklab_container_apps||[]).push([[648],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return h}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var o=a.createContext({}),c=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=c(e.components);return a.createElement(o.Provider,{value:t},e.children)},s={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,u=p(e,["components","mdxType","originalType","parentName"]),m=c(n),h=r,d=m["".concat(o,".").concat(h)]||m[h]||s[h]||i;return n?a.createElement(d,l(l({ref:t},u),{},{components:n})):a.createElement(d,l({ref:t},u))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=m;var p={};for(var o in t)hasOwnProperty.call(t,o)&&(p[o]=t[o]);p.originalType=e,p.mdxType="string"==typeof e?e:r,l[1]=p;for(var c=2;c<i;c++)l[c]=n[c];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},7135:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return o},default:function(){return h},frontMatter:function(){return p},metadata:function(){return c},toc:function(){return s}});var a=n(7462),r=n(3366),i=(n(7294),n(3905)),l=["components"],p={sidebar_label:"Deploy APIApp",slug:"/deploy-apiapp"},o="Deploy APIApp",c={unversionedId:"deploy-apiapp",id:"deploy-apiapp",title:"Deploy APIApp",description:"Objective",source:"@site/docs/04-deploy-apiapp.md",sourceDirName:".",slug:"/deploy-apiapp",permalink:"/lab-azure-container-apps/deploy-apiapp",draft:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_label:"Deploy APIApp",slug:"/deploy-apiapp"},sidebar:"tutorialSidebar",previous:{title:"Deploy WebApp",permalink:"/lab-azure-container-apps/deploy-webapp"},next:{title:"Update APIApp",permalink:"/lab-azure-container-apps/update-apiapp"}},u={},s=[{value:"Objective",id:"objective",level:2},{value:"Lab Script",id:"lab-script",level:2},{value:"Create Container App",id:"create-container-app",level:3},{value:"Auto Scale Up / Down",id:"auto-scale-up--down",level:3},{value:"Explore Azure Portal",id:"explore-azure-portal",level:3},{value:"Summary",id:"summary",level:2}],m={toc:s};function h(e){var t=e.components,p=(0,r.Z)(e,l);return(0,i.kt)("wrapper",(0,a.Z)({},m,p,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"deploy-apiapp"},"Deploy APIApp"),(0,i.kt)("h2",{id:"objective"},"Objective"),(0,i.kt)("p",null,"In this section we will create a Container App which will be the APIApp.  The WebApp that we create in the previous section will communicate with the APIApp."),(0,i.kt)("p",null,"The APIApp will not be exposed outside of the Container Apps Environment."),(0,i.kt)("p",null,"We will put the APIApp under a heavy workload and see how it scales-out."),(0,i.kt)("p",null,(0,i.kt)("img",{src:n(5309).Z,width:"2667",height:"1500"})),(0,i.kt)("h2",{id:"lab-script"},"Lab Script"),(0,i.kt)("h3",{id:"create-container-app"},"Create Container App"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Create the Container App for the APIApp ",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Container image is pulled from the GitHub container registry"),(0,i.kt)("li",{parentName:"ul"},"Specify that it can only be internally accessed - not exposed outside of the Container Apps Environment"),(0,i.kt)("li",{parentName:"ul"},"Specify that it can scale from 0 to 3 container instances (replicas) "),(0,i.kt)("li",{parentName:"ul"},"Specify revisions mode of 'multiple' - this allows a Container App to have more than one Container Image active")))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"az containerapp create -g $RG -o table \\\n  --image ghcr.io/markharrison/coloursapi:blue \\\n  --name coloursapi \\\n  --environment $CAENV \\\n  --ingress internal --target-port 80 \\\n  --min-replicas 0   --max-replicas 3 \\\n  --revision-suffix bluev1 \\\n  --revisions-mode multiple  \n")),(0,i.kt)("p",null,(0,i.kt)("img",{src:n(5115).Z,width:"1920",height:"710"})),(0,i.kt)("p",null,"Note the name of the URL that is emitted - in the above example it is:"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"https://coloursapi.internal.jollymushroom-52b07fac.northeurope.azurecontainerapps.io/")),(0,i.kt)("h3",{id:"auto-scale-up--down"},"Auto Scale Up / Down"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Check number of replicas")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"az containerapp replica list  -g $RG -o table \\\n  --name coloursapi \\\n  --revision coloursapi--bluev1\n")),(0,i.kt)("p",null,(0,i.kt)("img",{src:n(5603).Z,width:"1920",height:"431"})),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Return to the web browser - and using the menu select Config (access via top left burger icon)"),(0,i.kt)("li",{parentName:"ul"},"Enter the following values:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},'API URL - set to the internal URL of the API app + "/colours/random" ... e.g. ',(0,i.kt)("a",{parentName:"li",href:"https://coloursapi.internal.jollymushroom-52b07fac.northeurope.azurecontainerapps.io/colours/random"},"https://coloursapi.internal.jollymushroom-52b07fac.northeurope.azurecontainerapps.io/colours/random")),(0,i.kt)("li",{parentName:"ul"},"API Mode: unchecked ... the call to the API goes via the front-end container - remember the API is not exposed outside the environment"),(0,i.kt)("li",{parentName:"ul"},"Number of Lights to 10 ... at this stage we want a low traffic rate "),(0,i.kt)("li",{parentName:"ul"},"Select ","[Submit]")))),(0,i.kt)("p",null,(0,i.kt)("img",{src:n(9985).Z,width:"1920",height:"875"})),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Select ","[Start]"),(0,i.kt)("li",{parentName:"ul"},"Each light will call the APIApp to get a random color - the light will then take that colour.")),(0,i.kt)("p",null,(0,i.kt)("img",{src:n(2551).Z,width:"1920",height:"705"})),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Check the number of replicas ... with a low rate on the APIApp - the nunmber of replicas should be 1")),(0,i.kt)("p",null,(0,i.kt)("img",{src:n(4359).Z,width:"1920",height:"431"})),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Return to config - and set the number of lights to 500")),(0,i.kt)("p",null,(0,i.kt)("img",{src:n(5345).Z,width:"1920",height:"1197"})),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Check the number of replicas ... with a high rate on the APIApp - the number of replicas has scaled up to the maximum of 3")),(0,i.kt)("p",null,(0,i.kt)("img",{src:n(3258).Z,width:"1920",height:"431"})),(0,i.kt)("h3",{id:"explore-azure-portal"},"Explore Azure Portal"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"In the Azure portal we can see the Container App.  Explore the various menu options.")),(0,i.kt)("p",null,(0,i.kt)("img",{src:n(1802).Z,width:"1920",height:"1884"})," "),(0,i.kt)("p",null,(0,i.kt)("img",{src:n(5228).Z,width:"1920",height:"1884"})),(0,i.kt)("h2",{id:"summary"},"Summary"),(0,i.kt)("p",null,"In this section we created our second application - the APIApp.  "),(0,i.kt)("p",null,"The Web App was configured to communicate with the APIApp ... the API returns random colours which was displayed by the WebApp. "),(0,i.kt)("p",null,"The number of replicas automatically scaled up when under a heavy load."))}h.isMDXComponent=!0},9985:function(e,t,n){t.Z=n.p+"assets/images/ScrnAccessConfig1-4abb6ca8ae590ec1fbf7cb702f744412.png"},2551:function(e,t,n){t.Z=n.p+"assets/images/ScrnAccessWeb2-41c36660a2e8d4cf244429a7dc4c6662.png"},5345:function(e,t,n){t.Z=n.p+"assets/images/ScrnAccessWeb3-2cdec2ef289ed41a5b719e05a6f2a3e1.png"},1802:function(e,t,n){t.Z=n.p+"assets/images/ScrnAzurePortalCAppAPI1-1f8ae459999011aefba4f74beb4080cb.png"},5228:function(e,t,n){t.Z=n.p+"assets/images/ScrnAzurePortalCappAPI2-06f353c702268cf9964eb7ace47eb69b.png"},5115:function(e,t,n){t.Z=n.p+"assets/images/ScrnCreateBluev1-6d544664746ad20b45112c9d57755ec5.png"},5603:function(e,t,n){t.Z=n.p+"assets/images/ScrnReplicaBlue1-9ca62e0718d92aacc462714d1d65a8ff.png"},4359:function(e,t,n){t.Z=n.p+"assets/images/ScrnReplicaBlue2-15511e74f94728887f327869b56dd8c1.png"},3258:function(e,t,n){t.Z=n.p+"assets/images/ScrnReplicaBlue3-0d984a141bb2895ceac864d2e11625a1.png"},5309:function(e,t,n){t.Z=n.p+"assets/images/Slide3-3197d1b33f99f015448be27bbc83c393.png"}}]);