"use strict";(self.webpackChunklab_container_apps=self.webpackChunklab_container_apps||[]).push([[782],{1800:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>l,toc:()=>o});var t=i(4848),s=i(8453);const a={sidebar_label:"Deploy APIApp",slug:"/deploy-apiapp"},r="Deploy APIApp",l={id:"deploy-apiapp",title:"Deploy APIApp",description:"Objective",source:"@site/docs/04-deploy-apiapp.md",sourceDirName:".",slug:"/deploy-apiapp",permalink:"/lab-azure-container-apps/deploy-apiapp",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_label:"Deploy APIApp",slug:"/deploy-apiapp"},sidebar:"tutorialSidebar",previous:{title:"Deploy WebApp",permalink:"/lab-azure-container-apps/deploy-webapp"},next:{title:"Update APIApp",permalink:"/lab-azure-container-apps/update-apiapp"}},c={},o=[{value:"Objective",id:"objective",level:2},{value:"Lab Script",id:"lab-script",level:2},{value:"Create Container App",id:"create-container-app",level:3},{value:"Auto Scale Up / Down",id:"auto-scale-up--down",level:3},{value:"Explore Azure Portal",id:"explore-azure-portal",level:3},{value:"Summary",id:"summary",level:2}];function p(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"deploy-apiapp",children:"Deploy APIApp"}),"\n",(0,t.jsx)(n.h2,{id:"objective",children:"Objective"}),"\n",(0,t.jsx)(n.p,{children:"In this section we will create a Container App which will be the APIApp.  The WebApp that we create in the previous section will communicate with the APIApp."}),"\n",(0,t.jsx)(n.p,{children:"The APIApp will not be exposed outside of the Container Apps Environment."}),"\n",(0,t.jsx)(n.p,{children:"We will put the APIApp under a heavy workload and see how it scales-out."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:i(8423).A+"",width:"2667",height:"1500"})}),"\n",(0,t.jsx)(n.h2,{id:"lab-script",children:"Lab Script"}),"\n",(0,t.jsx)(n.h3,{id:"create-container-app",children:"Create Container App"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Create the Container App for the APIApp","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Container image is pulled from the GitHub container registry"}),"\n",(0,t.jsx)(n.li,{children:"Specify that it can only be internally accessed - not exposed outside of the Container Apps Environment"}),"\n",(0,t.jsx)(n.li,{children:"Specify that it can scale from 0 to 3 container instances (replicas)"}),"\n",(0,t.jsx)(n.li,{children:"Specify revisions mode of 'multiple' - this allows a Container App to have more than one Container Image active"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"az containerapp create -g $RG -o table \\\n  --image ghcr.io/markharrison/coloursapi:blue \\\n  --name coloursapi \\\n  --environment $CAENV \\\n  --ingress internal --target-port 80 \\\n  --min-replicas 0   --max-replicas 3 \\\n  --revision-suffix bluev1 \\\n  --revisions-mode multiple  \n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:i(968).A+"",width:"1920",height:"710"})}),"\n",(0,t.jsx)(n.p,{children:"Note the name of the URL that is emitted - in the above example it is:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"https://coloursapi.internal.jollymushroom-52b07fac.northeurope.azurecontainerapps.io/"})}),"\n",(0,t.jsx)(n.h3,{id:"auto-scale-up--down",children:"Auto Scale Up / Down"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Check number of replicas"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"az containerapp replica list  -g $RG -o table \\\n  --name coloursapi \\\n  --revision coloursapi--bluev1\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:i(8322).A+"",width:"1920",height:"431"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Return to the web browser - and using the menu select Config (access via top left burger icon)"}),"\n",(0,t.jsxs)(n.li,{children:["Enter the following values:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:['API URL - set to the internal URL of the API app + "/colours/random" ... e.g. ',(0,t.jsx)(n.a,{href:"https://coloursapi.internal.jollymushroom-52b07fac.northeurope.azurecontainerapps.io/colours/random",children:"https://coloursapi.internal.jollymushroom-52b07fac.northeurope.azurecontainerapps.io/colours/random"})]}),"\n",(0,t.jsx)(n.li,{children:"API Mode: unchecked ... the call to the API goes via the front-end container - remember the API is not exposed outside the environment"}),"\n",(0,t.jsx)(n.li,{children:"Number of Lights to 10 ... at this stage we want a low traffic rate"}),"\n",(0,t.jsx)(n.li,{children:"Select [Submit]"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:i(3630).A+"",width:"1920",height:"875"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Select [Start]"}),"\n",(0,t.jsx)(n.li,{children:"Each light will call the APIApp to get a random color - the light will then take that colour."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:i(3701).A+"",width:"1920",height:"705"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Check the number of replicas ... with a low rate on the APIApp - the nunmber of replicas should be 1"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:i(9033).A+"",width:"1920",height:"431"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Return to config - and set the number of lights to 500"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:i(1436).A+"",width:"1920",height:"1197"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Check the number of replicas ... with a high rate on the APIApp - the number of replicas has scaled up to the maximum of 3"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:i(7856).A+"",width:"1920",height:"431"})}),"\n",(0,t.jsx)(n.h3,{id:"explore-azure-portal",children:"Explore Azure Portal"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"In the Azure portal we can see the Container App.  Explore the various menu options."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:i(17).A+"",width:"1920",height:"1884"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:i(2474).A+"",width:"1920",height:"1884"})}),"\n",(0,t.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,t.jsx)(n.p,{children:"In this section we created our second application - the APIApp."}),"\n",(0,t.jsx)(n.p,{children:"The Web App was configured to communicate with the APIApp ... the API returns random colours which was displayed by the WebApp."}),"\n",(0,t.jsx)(n.p,{children:"The number of replicas automatically scaled up when under a heavy load."})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(p,{...e})}):p(e)}},3630:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/ScrnAccessConfig1-4abb6ca8ae590ec1fbf7cb702f744412.png"},3701:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/ScrnAccessWeb2-41c36660a2e8d4cf244429a7dc4c6662.png"},1436:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/ScrnAccessWeb3-2cdec2ef289ed41a5b719e05a6f2a3e1.png"},17:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/ScrnAzurePortalCAppAPI1-1f8ae459999011aefba4f74beb4080cb.png"},2474:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/ScrnAzurePortalCappAPI2-06f353c702268cf9964eb7ace47eb69b.png"},968:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/ScrnCreateBluev1-6d544664746ad20b45112c9d57755ec5.png"},8322:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/ScrnReplicaBlue1-9ca62e0718d92aacc462714d1d65a8ff.png"},9033:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/ScrnReplicaBlue2-15511e74f94728887f327869b56dd8c1.png"},7856:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/ScrnReplicaBlue3-0d984a141bb2895ceac864d2e11625a1.png"},8423:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/Slide3-3197d1b33f99f015448be27bbc83c393.png"},8453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>l});var t=i(6540);const s={},a=t.createContext(s);function r(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);